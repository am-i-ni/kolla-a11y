javascript:(function(){const ka_prefix="kolla-a11y";const ka_toolbarId=`${ka_prefix}-toolbar`;const ka_styleId=`${ka_prefix}-styles`;const ka_outputId=`${ka_prefix}-output`;let ka_currentActiveTool=null;let ka_isCssToggledOff=!1;let ka_headingCheckData=[];let ka_headingCheckFilter="all";const ka_AMBIGUOUS_LINK_TEXT={en:["click here","learn more","read more","more","link","here","info","details","continue"],sv:["klicka här","läs mer","mer","länk","här","info","detaljer","fortsätt"]};const ka_SKIP_LINK_TEXT={en:["skip to content","skip to main content","skip navigation","skip to main"],sv:["hoppa till innehåll","hoppa till huvudinnehåll","hoppa över navigering","hoppa över meny","till innehållet"]};const ka_IMAGE_HIGHLIGHT_CLASSES=[`${ka_prefix}-highlight-image-alt-present`,`${ka_prefix}-highlight-image-alt-empty`,`${ka_prefix}-highlight-image-alt-missing`,`${ka_prefix}-highlight-svg-named`,`${ka_prefix}-highlight-svg-decorative`,`${ka_prefix}-highlight-svg-missing`,`${ka_prefix}-highlight-svg-unclear`,`${ka_prefix}-highlight-svg-hidden`];const ka_WCAG_THRESHOLDS={AA_NORMAL:4.5,AA_LARGE_UI:3,AAA_NORMAL:7,AAA_LARGE:4.5};const ka_cleanupLandmarks=()=>{console.log("Kolla A11y: Removing Landmark Highlights & Panel");document.querySelectorAll(`.${ka_prefix}-highlight-landmark`).forEach(ka_el=>{ka_el.classList.remove(`${ka_prefix}-highlight-landmark`);ka_el.style.removeProperty(`--${ka_prefix}-landmark-role`)});const ka_panel=document.getElementById(ka_outputId);if(ka_panel){ka_panel.remove()}};const ka_cleanupLinks=()=>{console.log("Kolla A11y: Removing Link Highlights & Panel");document.querySelectorAll(`.${ka_prefix}-highlight-link, .${ka_prefix}-highlight-link-issue`).forEach(ka_el=>{ka_el.classList.remove(`${ka_prefix}-highlight-link`);ka_el.classList.remove(`${ka_prefix}-highlight-link-issue`);ka_el.style.removeProperty(`--${ka_prefix}-link-status`)});const ka_panel=document.getElementById(ka_outputId);if(ka_panel){ka_panel.remove()}};const ka_cleanupFocusable=()=>{console.log("Kolla A11y: Removing Focusable Highlights & Panel");document.querySelectorAll(`.${ka_prefix}-highlight-focusable`).forEach(ka_el=>{ka_el.classList.remove(`${ka_prefix}-highlight-focusable`);ka_el.style.removeProperty(`--${ka_prefix}-tabindex-value`);ka_el.removeAttribute("data-kolla-tabindex");ka_el.removeAttribute("data-kolla-tabindex-positive")});const ka_panel=document.getElementById(ka_outputId);if(ka_panel){ka_panel.remove()}};const ka_cleanupContrastCheck=()=>{console.log("Kolla A11y: Removing Contrast Panel");document.querySelectorAll(`.${ka_prefix}-highlight-contrast-issue`).forEach(ka_el=>{ka_el.classList.remove(`${ka_prefix}-highlight-contrast-issue`)});const ka_panel=document.getElementById(ka_outputId);if(ka_panel){ka_panel.remove()}};const ka_runLandmarksCheck=()=>{console.log("Kolla A11y: Running Landmarks Check...");ka_cleanupLandmarks();const ka_selector="header:not(section header, article header, aside header, nav header, main header),footer:not(section footer, article footer, aside footer, nav footer, main footer),main, nav, aside,[role=\"banner\"], [role=\"navigation\"], [role=\"main\"], [role=\"complementary\"],[role=\"contentinfo\"], [role=\"search\"], form[aria-label], form[aria-labelledby],[role=\"form\"][aria-label], [role=\"form\"][aria-labelledby],[role=\"region\"][aria-label], [role=\"region\"][aria-labelledby]";const ka_landmarks=Array.from(document.querySelectorAll(ka_selector));const ka_outputItems=[];let ka_hasMain=!1;ka_landmarks.forEach((ka_landmark,ka_index)=>{if(ka_landmark.closest(`#${ka_toolbarId}`)||ka_landmark.closest(`#${ka_outputId}`))return;const ka_targetId=`${ka_prefix}-landmark-${ka_index}`;ka_landmark.setAttribute("data-kolla-a11y-id",ka_targetId);ka_landmark.classList.add(`${ka_prefix}-highlight-landmark`);const ka_tagName=ka_landmark.tagName.toLowerCase();const ka_explicitRole=ka_landmark.getAttribute("role");let ka_effectiveRole=ka_explicitRole;let ka_roleSource="role";if(!ka_explicitRole){if("header"===ka_tagName&&!ka_landmark.closest("section, article, aside, nav, main"))ka_effectiveRole="banner";else if("footer"===ka_tagName&&!ka_landmark.closest("section, article, aside, nav, main"))ka_effectiveRole="contentinfo";else if("main"===ka_tagName)ka_effectiveRole="main";else if("nav"===ka_tagName)ka_effectiveRole="navigation";else if("aside"===ka_tagName)ka_effectiveRole="complementary";else if("form"===ka_tagName)ka_effectiveRole="form";if(ka_effectiveRole&&!ka_explicitRole)ka_roleSource="tag"}if("section"===ka_tagName&&ka_getAccessibleName(ka_landmark)){ka_effectiveRole="region";ka_roleSource="tag"}if("search"===ka_effectiveRole&&"form"===ka_tagName&&"role"===ka_roleSource){ka_roleSource="form[role=search]"}if(!ka_effectiveRole)return;const ka_accessibleName=ka_getAccessibleName(ka_landmark);let ka_issues=[];if(("region"===ka_effectiveRole||"form"===ka_effectiveRole)&&!ka_accessibleName){ka_issues.push(`Landmark role "${ka_effectiveRole}" requires an accessible name (aria-label or aria-labelledby).`)}"main"===ka_effectiveRole&&(ka_hasMain=!0);const ka_overlayText=ka_effectiveRole.toUpperCase();ka_landmark.style.setProperty(`--${ka_prefix}-landmark-role`,`'${ka_overlayText}'`);ka_outputItems.push({targetId:ka_targetId,role:ka_effectiveRole,roleSource:ka_roleSource,elementTag:`<${ka_tagName}>`,name:ka_accessibleName,issues:ka_issues})});const ka_panelCloseBtnId=`${ka_outputId}-close-btn`;let ka_panelHtml=`<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><h3 id="${ka_prefix}-panel-title" style="margin: 0;">Landmarks</h3><button id="${ka_panelCloseBtnId}" aria-label="Close Landmarks Panel" class="${ka_prefix}-panel-close-btn">×</button></div>`;ka_hasMain||(ka_panelHtml+=`<div class="${ka_prefix}-landmark-warning">⚠️ Warning: No main landmark (<main> or role="main") found.</div>`);ka_panelHtml+=`<div id="${ka_prefix}-list-container">`;if(ka_outputItems.length===0){ka_panelHtml+='<p>No landmarks found on this page.</p>'}else{ka_panelHtml+=`<div class="${ka_prefix}-info-header">Found: ${ka_outputItems.length} landmarks.</div>`;ka_outputItems.forEach(ka_item=>{const ka_errorClass=ka_item.issues.length>0?` ${ka_prefix}-heading-error`:"";ka_panelHtml+=`<div class="${ka_prefix}-landmark-item${ka_errorClass}">`;ka_panelHtml+=`<strong class="${ka_prefix}-landmark-role" data-target-id="${ka_item.targetId}" title="Click to scroll to element" style="cursor:pointer;">${ka_item.role}</strong>`;if(ka_item.name){ka_panelHtml+=`<div class="${ka_prefix}-landmark-name">Name: ${ka_item.name}</div>`}else if("region"===ka_item.role||"form"===ka_item.role){ka_panelHtml+=`<div class="${ka_prefix}-landmark-name ${ka_prefix}-issue">[Requires Name]</div>`}else{ka_panelHtml+=`<div class="${ka_prefix}-landmark-name">[No explicit name]</div>`}ka_panelHtml+=`<div class="${ka_prefix}-landmark-element">Element: ${ka_item.elementTag} ${"role"===ka_item.roleSource?`(role="${ka_item.role}")`:"(Implicit from tag)"}</div>`;if(ka_item.issues.length>0){ka_panelHtml+=`<div class="${ka_prefix}-issue">Issue: ${ka_item.issues.join("; ")}</div>`}ka_panelHtml+=`</div>`})}ka_panelHtml+=`</div>`;const ka_panelElement=document.createElement("div");ka_panelElement.id=ka_outputId;ka_panelElement.innerHTML=ka_panelHtml;document.body.appendChild(ka_panelElement);ka_panelElement.addEventListener("click",ka_event=>{const ka_targetId=ka_event.target.closest("[data-target-id]")?.dataset.targetId;if(ka_targetId){ka_event.preventDefault();const ka_targetElement=document.querySelector(`[data-kolla-a11y-id="${ka_targetId}"]`);if(ka_targetElement){ka_targetElement.setAttribute("tabindex","-1");ka_targetElement.focus({preventScroll:!0});ka_targetElement.removeAttribute("tabindex");ka_targetElement.scrollIntoView({behavior:"smooth",block:"center"})}return}const ka_closeButton=ka_event.target.closest(`.${ka_prefix}-panel-close-btn`);if(ka_closeButton){ka_event.preventDefault();ka_cleanupLandmarks();const ka_landmarkToolButton=document.querySelector(`#${ka_toolbarId} button[data-tool="landmarks"]`);if(ka_landmarkToolButton)ka_landmarkToolButton.setAttribute("aria-pressed","false");ka_currentActiveTool=null}})} ;const ka_runLinksCheck=()=>{console.log("Kolla A11y: Running Links Check...");ka_cleanupLinks();let ka_pageLang=document.documentElement.lang||"en";ka_pageLang=ka_pageLang.split("-")[0].toLowerCase();const ka_skipLinkInfo=ka_getSkipLinkStatus(ka_pageLang);const ka_ambiguousPhrases=ka_AMBIGUOUS_LINK_TEXT[ka_pageLang]||ka_AMBIGUOUS_LINK_TEXT.en;const ka_links=Array.from(document.querySelectorAll("a"));const ka_outputItems=[];let ka_linkCount=0;let ka_issueCount=0;ka_links.forEach((ka_link,ka_index)=>{if(ka_link.closest(`#${ka_toolbarId}`)||ka_link.closest(`#${ka_outputId}`))return;const ka_targetId=`${ka_prefix}-link-${ka_index}`;ka_link.setAttribute("data-kolla-a11y-id",ka_targetId);const ka_href=ka_link.getAttribute("href");const ka_linkText=ka_getAccessibleLinkText(ka_link);const ka_linkTextLower=ka_linkText.toLowerCase();let ka_issues=[];let ka_statusText="LINK";let ka_highlightClass=`${ka_prefix}-highlight-link`;if(ka_href){if(ka_href.trim()===""){ka_issues.push("Empty href attribute.");ka_statusText='HREF=""'}else if(ka_href.trim()==="#"){ka_issues.push('Placeholder href="#" used.');ka_statusText='HREF="#"'}}else{ka_issues.push("Missing href attribute.");ka_statusText="NO HREF"}if(ka_linkText==="[Empty or non-text content]"){if(ka_href){ka_issues.push("Link has no discernible text content.");ka_statusText="EMPTY"}else return}else if(ka_linkText==="[Image missing alt]"||ka_linkText==="[SVG role=img missing name]"){ka_issues.push("Link contains image/SVG with missing accessible name.");ka_statusText="NO IMG/SVG NAME"}else if(ka_ambiguousPhrases.includes(ka_linkTextLower)){ka_issues.push(`Ambiguous link text: "${ka_linkText}".`);ka_statusText="AMBIGUOUS"}if(ka_link.getAttribute("target")==="_blank"){ka_issues.push('Opens in new window (target="_blank"). Verify warning.');ka_statusText==="LINK"&&(ka_statusText="NEW WINDOW")}if(ka_issues.length>0){ka_highlightClass=`${ka_prefix}-highlight-link-issue`;ka_issueCount++}ka_link.classList.add(ka_highlightClass);ka_link.style.setProperty(`--${ka_prefix}-link-status`,`'${ka_statusText}'`);ka_linkCount++;ka_outputItems.push({targetId:ka_targetId,href:ka_href||"[None]",text:ka_linkText,issues:ka_issues})});const ka_panelCloseBtnId=`${ka_outputId}-close-btn`;let ka_panelHtml=`<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><h3 id="${ka_prefix}-panel-title" style="margin: 0;">Links Analysis</h3><button id="${ka_panelCloseBtnId}" aria-label="Close Links Panel" class="${ka_prefix}-panel-close-btn">×</button></div>`;ka_panelHtml+=`<div class="${ka_prefix}-skip-link-info"><strong>Skip Link Check:</strong> <span class="${ka_skipLinkInfo.found&&!ka_skipLinkInfo.targetExists?ka_prefix+"-issue":""}">${ka_skipLinkInfo.message}</span></div>`;ka_panelHtml+=`<div class="${ka_prefix}-info-header">Found: ${ka_linkCount} links. Issues detected: ${ka_issueCount}.</div>`;ka_panelHtml+=`<div id="${ka_prefix}-list-container">`;if(ka_outputItems.length===0){ka_panelHtml+='<p>No links found on this page.</p>'}else{ka_outputItems.forEach(ka_item=>{const ka_errorClass=ka_item.issues.length>0?` ${ka_prefix}-heading-error`:"";ka_panelHtml+=`<div class="${ka_prefix}-link-item${ka_errorClass}">`;ka_panelHtml+=`<a href="#" class="${ka_prefix}-link-text" data-target-id="${ka_item.targetId}">${ka_item.text}</a>`;ka_panelHtml+=`<div class="${ka_prefix}-link-href">Href: ${ka_item.href}</div>`;if(ka_item.issues.length>0){ka_panelHtml+=`<div class="${ka_prefix}-issue">Issues: ${ka_item.issues.join("; ")}</div>`}ka_panelHtml+=`</div>`})}ka_panelHtml+=`</div>`;const ka_panelElement=document.createElement("div");ka_panelElement.id=ka_outputId;ka_panelElement.innerHTML=ka_panelHtml;document.body.appendChild(ka_panelElement);ka_panelElement.addEventListener("click",ka_event=>{const ka_targetId=ka_event.target.closest("[data-target-id]")?.dataset.targetId;if(ka_targetId){ka_event.preventDefault();const ka_targetElement=document.querySelector(`[data-kolla-a11y-id="${ka_targetId}"]`);if(ka_targetElement){ka_targetElement.setAttribute("tabindex","-1");ka_targetElement.focus({preventScroll:!0});ka_targetElement.removeAttribute("tabindex");ka_targetElement.scrollIntoView({behavior:"smooth",block:"center"})}return}const ka_closeButton=ka_event.target.closest(`.${ka_prefix}-panel-close-btn`);if(ka_closeButton){ka_event.preventDefault();ka_cleanupLinks();const ka_linkToolButton=document.querySelector(`#${ka_toolbarId} button[data-tool="links"]`);if(ka_linkToolButton)ka_linkToolButton.setAttribute("aria-pressed","false");ka_currentActiveTool=null}})} ;const ka_runFocusableCheck=()=>{console.log("Kolla A11y: Running Focusable Elements Check...");ka_cleanupFocusable();const ka_focusableSelectors=["a[href]","area[href]","button","input","select","textarea","iframe","[tabindex]","[contenteditable]"];const ka_allPotential=Array.from(document.querySelectorAll(ka_focusableSelectors.join(",")));const ka_focusableElements=[];let ka_positiveTabIndexCount=0;ka_allPotential.forEach((ka_el,ka_index)=>{if(ka_el.closest(`#${ka_toolbarId}`)||ka_el.closest(`#${ka_outputId}`))return;if(ka_el.hasAttribute("disabled")||ka_el.getAttribute("aria-disabled")==="true"){return}const ka_visibility=ka_getElementVisibility(ka_el);if(ka_visibility==="hidden"||ka_visibility==="visually-hidden"){return}let ka_tabIndex=ka_el.hasAttribute("tabindex")?parseInt(ka_el.getAttribute("tabindex"),10):0;if(isNaN(ka_tabIndex))ka_tabIndex=0;if(ka_tabIndex<0)return;const ka_name=ka_getAccessibleName(ka_el);let ka_issues=[];if(ka_tabIndex>0){ka_issues.push(`Positive tabindex (${ka_tabIndex}) disrupts natural order.`);ka_positiveTabIndexCount++}if(!ka_name){const ka_labelledControl=ka_el.querySelector('input[id], select[id], textarea[id]');if(!ka_labelledControl||!document.querySelector(`label[for="${ka_labelledControl.id}"]`)){ka_issues.push("Focusable element may lack an accessible name.")}}ka_focusableElements.push({element:ka_el,index:ka_index,tabIndex:ka_tabIndex,name:ka_name||"[No Name Found]",issues:ka_issues,targetId:`${ka_prefix}-focusable-${ka_index}`})});ka_focusableElements.sort((a,b)=>{if(a.tabIndex>0&&b.tabIndex>0)return a.tabIndex-b.tabIndex;if(a.tabIndex>0)return-1;if(b.tabIndex>0)return 1;return a.index-b.index});const ka_panelCloseBtnId=`${ka_outputId}-close-btn`;let ka_panelHtml=`<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><h3 id="${ka_prefix}-panel-title" style="margin: 0;">Focusable Elements Order</h3><button id="${ka_panelCloseBtnId}" aria-label="Close Focusable Panel" class="${ka_prefix}-panel-close-btn">×</button></div>`;if(ka_positiveTabIndexCount>0){ka_panelHtml+=`<div class="${ka_prefix}-landmark-warning">⚠️ Found ${ka_positiveTabIndexCount} element(s) with positive tabindex. This forces focus order and should usually be avoided.</div>`}ka_panelHtml+=`<div class="${ka_prefix}-info-header">Found: ${ka_focusableElements.length} focusable elements.</div>`;ka_panelHtml+=`<div id="${ka_prefix}-list-container">`;if(ka_focusableElements.length===0){ka_panelHtml+='<p>No focusable elements found on this page.</p>'}else{ka_focusableElements.forEach((ka_item,ka_focusOrderIndex)=>{const ka_el=ka_item.element;const ka_targetId=ka_item.targetId;ka_el.setAttribute("data-kolla-a11y-id",ka_targetId);ka_el.classList.add(`${ka_prefix}-highlight-focusable`);const ka_errorClass=ka_item.issues.length>0?` ${ka_prefix}-heading-error`:"";ka_panelHtml+=`<div class="${ka_prefix}-focusable-item${ka_errorClass}">`;ka_panelHtml+=`<span class="${ka_prefix}-focusable-order">${ka_focusOrderIndex+1}.</span>`;ka_panelHtml+=`<span class="${ka_prefix}-focusable-element" data-target-id="${ka_targetId}" title="Click to scroll to element"><${ka_el.tagName.toLowerCase()}></span>`;ka_panelHtml+=`<div class="${ka_prefix}-focusable-name">Name: ${ka_item.name}</div>`;if(ka_el.hasAttribute("tabindex")){ka_el.setAttribute("data-kolla-tabindex",ka_item.tabIndex);ka_el.style.setProperty(`--${ka_prefix}-tabindex-value`,ka_item.tabIndex);if(ka_item.tabIndex>0)ka_el.setAttribute("data-kolla-tabindex-positive","");ka_panelHtml+=`<div class="${ka_prefix}-focusable-tabindex">Tabindex: ${ka_item.tabIndex}</div>`}if(ka_item.issues.length>0){ka_panelHtml+=`<div class="${ka_prefix}-issue">Issues: ${ka_item.issues.join("; ")}</div>`}ka_panelHtml+=`</div>`})}ka_panelHtml+=`</div>`;const ka_panelElement=document.createElement("div");ka_panelElement.id=ka_outputId;ka_panelElement.innerHTML=ka_panelHtml;document.body.appendChild(ka_panelElement);ka_panelElement.addEventListener("click",ka_event=>{const ka_targetId=ka_event.target.closest("[data-target-id]")?.dataset.targetId;if(ka_targetId){ka_event.preventDefault();const ka_targetElement=document.querySelector(`[data-kolla-a11y-id="${ka_targetId}"]`);if(ka_targetElement){ka_targetElement.focus({preventScroll:!0});ka_targetElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}return}const ka_closeButton=ka_event.target.closest(`.${ka_prefix}-panel-close-btn`);if(ka_closeButton){ka_event.preventDefault();ka_cleanupFocusable();const ka_focusableToolButton=document.querySelector(`#${ka_toolbarId} button[data-tool="focusable"]`);if(ka_focusableToolButton)ka_focusableToolButton.setAttribute("aria-pressed","false");ka_currentActiveTool=null}})} ;function ka_hexToRgb(ka_hex){if(!ka_hex||typeof ka_hex!=="string")return null;let ka_cleanHex=ka_hex.startsWith("#")?ka_hex.slice(1):ka_hex;if(!/^[0-9a-fA-F]+$/.test(ka_cleanHex))return null;if(ka_cleanHex.length===3){ka_cleanHex=ka_cleanHex.split("").map(ka_char=>ka_char+ka_char).join("")}if(ka_cleanHex.length!==6)return null;const ka_r=parseInt(ka_cleanHex.substring(0,2),16);const ka_g=parseInt(ka_cleanHex.substring(2,4),16);const ka_b=parseInt(ka_cleanHex.substring(4,6),16);return{r:ka_r,g:ka_g,b:ka_b}}function ka_rgbToHex(ka_rgb){if(!ka_rgb)return"#000000";const ka_toHex=ka_c=>("0"+ka_c.toString(16)).slice(-2);return`#${ka_toHex(ka_rgb.r)}${ka_toHex(ka_rgb.g)}${ka_toHex(ka_rgb.b)}`}function ka_parseRgbString(ka_rgbString){if(!ka_rgbString||!ka_rgbString.toLowerCase().startsWith("rgb"))return null;const ka_match=ka_rgbString.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*([\d.]+))?\)/i);if(!ka_match)return null;return{r:parseInt(ka_match[1],10),g:parseInt(ka_match[2],10),b:parseInt(ka_match[3],10),a:ka_match[4]!==undefined?parseFloat(ka_match[4]):1}}function ka_blendColors(ka_fgRgba,ka_bgRgb){if(ka_fgRgba.a===1)return{r:ka_fgRgba.r,g:ka_fgRgba.g,b:ka_fgRgba.b};if(ka_fgRgba.a===0)return ka_bgRgb;const ka_alpha=ka_fgRgba.a;const ka_invAlpha=1-ka_alpha;return{r:Math.round(ka_alpha*ka_fgRgba.r+ka_invAlpha*ka_bgRgb.r),g:Math.round(ka_alpha*ka_fgRgba.g+ka_invAlpha*ka_bgRgb.g),b:Math.round(ka_alpha*ka_fgRgba.b+ka_invAlpha*ka_bgRgb.b)}}function ka_getEffectiveBackgroundColor(ka_element){let ka_currentElement=ka_element;for(let ka_i=0;ka_i<5&&ka_currentElement;ka_i++){const ka_style=window.getComputedStyle(ka_currentElement);const ka_bgColor=ka_style.backgroundColor;const ka_bgRgba=ka_parseRgbString(ka_bgColor);if(ka_bgRgba&&ka_bgRgba.a>0){if(ka_bgRgba.a===1)return ka_bgRgba;const ka_parentBg=ka_getEffectiveBackgroundColor(ka_currentElement.parentElement)||(ka_i===4?{r:255,g:255,b:255}:null);if(ka_parentBg)return ka_blendColors(ka_bgRgba,ka_parentBg)}if(ka_style.backgroundImage!=="none")return null;ka_currentElement=ka_currentElement.parentElement}return{r:255,g:255,b:255}}function ka_getRelativeLuminance(ka_rgb){if(!ka_rgb)return 0;const ka_rsrgb=ka_rgb.r/255;const ka_gsrgb=ka_rgb.g/255;const ka_bsrgb=ka_rgb.b/255;const ka_r=ka_rsrgb<=.03928?ka_rsrgb/12.92:((ka_rsrgb+.055)/1.055)**2.4;const ka_g=ka_gsrgb<=.03928?ka_gsrgb/12.92:((ka_gsrgb+.055)/1.055)**2.4;const ka_b=ka_bsrgb<=.03928?ka_bsrgb/12.92:((ka_bsrgb+.055)/1.055)**2.4;return.2126*ka_r+.7152*ka_g+.0722*ka_b}function ka_getContrastRatio(ka_rgb1,ka_rgb2){const ka_lum1=ka_getRelativeLuminance(ka_rgb1);const ka_lum2=ka_getRelativeLuminance(ka_rgb2);const ka_lighter=Math.max(ka_lum1,ka_lum2);const ka_darker=Math.min(ka_lum1,ka_lum2);return(ka_lighter+.05)/(ka_darker+.05)}function ka_checkWcagContrast(ka_ratio){return{aaNormal:ka_ratio>=ka_WCAG_THRESHOLDS.AA_NORMAL,aaLargeUI:ka_ratio>=ka_WCAG_THRESHOLDS.AA_LARGE_UI,aaaNormal:ka_ratio>=ka_WCAG_THRESHOLDS.AAA_NORMAL,aaaLarge:ka_ratio>=ka_WCAG_THRESHOLDS.AAA_LARGE}}function ka_runAutomatedContrastScan(){const ka_scanResultsContainer=document.getElementById(`${ka_prefix}-scan-results`);const ka_scanButton=document.getElementById(`${ka_prefix}-scan-button`);ka_scanResultsContainer.innerHTML='<p>Scanning page... (This may take a moment)</p>';ka_scanButton.disabled=!0;setTimeout(()=>{const ka_elementsToScan=Array.from(document.querySelectorAll("p, span, a, h1, h2, h3, h4, h5, h6, li, dd, dt, button, [role=button], input[type=button], input[type=submit], summary"));const ka_issuesFound=[];ka_elementsToScan.forEach((ka_el,ka_index)=>{if(ka_el.closest(`#${ka_toolbarId}, #${ka_outputId}`))return;const ka_style=window.getComputedStyle(ka_el);const ka_text=(ka_el.textContent||"").trim();if(!ka_text)return;if(ka_getElementVisibility(ka_el)!=='visible')return;const ka_rect=ka_el.getBoundingClientRect();if(ka_rect.width<1||ka_rect.height<1)return;const ka_fgColorString=ka_style.color;const ka_fgRgba=ka_parseRgbString(ka_fgColorString);if(!ka_fgRgba)return;const ka_bgRgb=ka_getEffectiveBackgroundColor(ka_el);if(!ka_bgRgb)return;const ka_finalFgRgb=ka_blendColors(ka_fgRgba,ka_bgRgb);const ka_ratio=ka_getContrastRatio(ka_finalFgRgb,ka_bgRgb);const ka_fontSize=parseInt(ka_style.fontSize,10);const ka_fontWeight=ka_style.fontWeight;const ka_isLargeText=(ka_fontSize>=24||(ka_fontSize>=18.67&&(ka_fontWeight==="bold"||ka_fontWeight>="700")));const ka_requiredRatio=ka_isLargeText?ka_WCAG_THRESHOLDS.AA_LARGE_UI:ka_WCAG_THRESHOLDS.AA_NORMAL;if(ka_ratio<ka_requiredRatio){const ka_targetId=`${ka_prefix}-contrast-issue-${ka_index}`;ka_el.setAttribute("data-kolla-a11y-id",ka_targetId);ka_el.classList.add(`${ka_prefix}-highlight-contrast-issue`);ka_issuesFound.push({targetId:ka_targetId,textSnippet:ka_text.substring(0,50)+(ka_text.length>50?"...":""),fgHex:ka_rgbToHex(ka_finalFgRgb),bgHex:ka_rgbToHex(ka_bgRgb),ratio:ka_ratio.toFixed(2),elementTag:ka_el.tagName.toLowerCase()})}});let ka_resultHtml='<h4>Automated Scan Results (Simplified)</h4>';if(ka_issuesFound.length>0){ka_resultHtml+=`<p>Found ${ka_issuesFound.length} potential low contrast text elements (below AA):</p><ul>`;ka_issuesFound.forEach(ka_issue=>{ka_resultHtml+=`<li class="${ka_prefix}-contrast-issue-item"> <a href="#" data-target-id="${ka_issue.targetId}" title="Click to scroll"> <span class="${ka_prefix}-contrast-issue-tag"><${ka_issue.elementTag}></span> "${ka_issue.textSnippet}" </a> <div class="${ka_prefix}-contrast-issue-details"> Ratio: <strong>${ka_issue.ratio}:1</strong> | FG: <span style="color:${ka_issue.fgHex};background-color:${ka_issue.bgHex};padding:0 3px;border:1px solid #ccc;">${ka_issue.fgHex}</span> | BG: <span style="color:${ka_issue.bgHex};background-color:${ka_issue.fgHex};padding:0 3px;border:1px solid #ccc;">${ka_issue.bgHex}</span> </div> </li>`});ka_resultHtml+="</ul>"}else{ka_resultHtml+='<p>✅ No obvious low contrast text issues found (based on simplified scan).</p>'}ka_resultHtml+=`<p class="${ka_prefix}-contrast-disclaimer"><strong>Note:</strong> This scan is simplified and may miss issues with gradients, images, or complex overlaps. Manual verification is recommended.</p>`;ka_scanResultsContainer.innerHTML=ka_resultHtml;ka_scanButton.disabled=!1},10)}function ka_runContrastCheck(){console.log("Kolla A11y: Running Contrast Check...");ka_cleanupContrastCheck();const ka_panelCloseBtnId=`${ka_outputId}-close-btn`;const ka_panelHtml=`<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;"> <h3 id="${ka_prefix}-panel-title" style="margin: 0;">Color Contrast Checker</h3> <button id="${ka_panelCloseBtnId}" aria-label="Close Contrast Panel" class="${ka_prefix}-panel-close-btn">×</button> </div> <div class="${ka_prefix}-contrast-section"> <h4>Manual Checker</h4> <div class="${ka_prefix}-contrast-inputs"> <div class="${ka_prefix}-contrast-group"> <label for="${ka_prefix}-fg-hex">Foreground</label> <div class="${ka_prefix}-contrast-input-row"> <input type="text" id="${ka_prefix}-fg-hex" value="#ffffff" pattern="#?[0-9a-fA-F]{3,6}"> <input type="color" id="${ka_prefix}-fg-picker" value="#ffffff" aria-label="Foreground color picker"> </div> </div> <div class="${ka_prefix}-contrast-group"> <label for="${ka_prefix}-bg-hex">Background</label> <div class="${ka_prefix}-contrast-input-row"> <input type="text" id="${ka_prefix}-bg-hex" value="#000000" pattern="#?[0-9a-fA-F]{3,6}"> <input type="color" id="${ka_prefix}-bg-picker" value="#000000" aria-label="Background color picker"> </div> </div> </div> <div class="${ka_prefix}-contrast-results"> <div class="${ka_prefix}-contrast-ratio"> Contrast Ratio: <strong id="${ka_prefix}-contrast-value">-.-- : 1</strong> </div> <div id="${ka_prefix}-contrast-details"> <h5>AA Requirements</h5> <div class="${ka_prefix}-contrast-result-line">Normal Text (≥ 4.5): <span id="${ka_prefix}-result-aa-normal">---</span></div> <div class="${ka_prefix}-contrast-result-line">Large Text / UI (≥ 3): <span id="${ka_prefix}-result-aa-large">---</span></div> <h5>AAA Requirements</h5> <div class="${ka_prefix}-contrast-result-line">Normal Text (≥ 7): <span id="${ka_prefix}-result-aaa-normal">---</span></div> <div class="${ka_prefix}-contrast-result-line">Large Text (≥ 4.5): <span id="${ka_prefix}-result-aaa-large">---</span></div> </div> </div> </div> <hr class="${ka_prefix}-contrast-hr"> <div class="${ka_prefix}-contrast-section"> <h4>Automated Scan (Simplified)</h4> <button id="${ka_prefix}-scan-button" class="${ka_prefix}-contrast-scan-btn">Scan Page for Low Contrast Text</button> <div id="${ka_prefix}-scan-results" class="${ka_prefix}-scan-results-area"></div> </div>`;const ka_panelElement=document.createElement("div");ka_panelElement.id=ka_outputId;ka_panelElement.innerHTML=ka_panelHtml;document.body.appendChild(ka_panelElement);const ka_fgHexInput=document.getElementById(`${ka_prefix}-fg-hex`);const ka_fgPicker=document.getElementById(`${ka_prefix}-fg-picker`);const ka_bgHexInput=document.getElementById(`${ka_prefix}-bg-hex`);const ka_bgPicker=document.getElementById(`${ka_prefix}-bg-picker`);const ka_contrastValueSpan=document.getElementById(`${ka_prefix}-contrast-value`);const ka_resultAaNormal=document.getElementById(`${ka_prefix}-result-aa-normal`);const ka_resultAaLarge=document.getElementById(`${ka_prefix}-result-aa-large`);const ka_resultAaaNormal=document.getElementById(`${ka_prefix}-result-aaa-normal`);const ka_resultAaaLarge=document.getElementById(`${ka_prefix}-result-aaa-large`);const ka_updateResults=()=>{const ka_fgHex=ka_fgHexInput.value;const ka_bgHex=ka_bgHexInput.value;const ka_fgRgb=ka_hexToRgb(ka_fgHex);const ka_bgRgb=ka_hexToRgb(ka_bgHex);if(!ka_fgRgb||!ka_bgRgb){ka_contrastValueSpan.textContent="Invalid Hex";ka_resultAaNormal.textContent="❌";ka_resultAaLarge.textContent="❌";ka_resultAaaNormal.textContent="❌";ka_resultAaaLarge.textContent="❌";return}const ka_ratio=ka_getContrastRatio(ka_fgRgb,ka_bgRgb);const ka_results=ka_checkWcagContrast(ka_ratio);ka_contrastValueSpan.textContent=`${ka_ratio.toFixed(2)} : 1`;ka_resultAaNormal.textContent=ka_results.aaNormal?"✅ Pass":"❌ Fail";ka_resultAaLarge.textContent=ka_results.aaLargeUI?"✅ Pass":"❌ Fail";ka_resultAaaNormal.textContent=ka_results.aaaNormal?"✅ Pass":"❌ Fail";ka_resultAaaLarge.textContent=ka_results.aaaLarge?"✅ Pass":"❌ Fail"};ka_fgHexInput.addEventListener("input",()=>{try{ka_fgPicker.value=ka_fgHexInput.value}catch(ka_e){}ka_updateResults()});ka_fgPicker.addEventListener("input",()=>{ka_fgHexInput.value=ka_fgPicker.value;ka_updateResults()});ka_bgHexInput.addEventListener("input",()=>{try{ka_bgPicker.value=ka_bgHexInput.value}catch(ka_e){}ka_updateResults()});ka_bgPicker.addEventListener("input",()=>{ka_bgHexInput.value=ka_bgPicker.value;ka_updateResults()});document.getElementById(`${ka_prefix}-scan-button`)?.addEventListener("click",ka_runAutomatedContrastScan);ka_panelElement.addEventListener("click",ka_event=>{const ka_targetId=ka_event.target.closest('[data-target-id]')?.dataset.targetId;if(ka_targetId){ka_event.preventDefault();const ka_targetElement=document.querySelector(`[data-kolla-a11y-id="${ka_targetId}"]`);if(ka_targetElement){ka_targetElement.focus({preventScroll:!0});ka_targetElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}return}const ka_closeButton=ka_event.target.closest(`.${ka_prefix}-panel-close-btn`);if(ka_closeButton){ka_event.preventDefault();ka_cleanupContrastCheck();const ka_contrastToolButton=document.querySelector(`#${ka_toolbarId} button[data-tool="contrast"]`);if(ka_contrastToolButton)ka_contrastToolButton.setAttribute("aria-pressed","false");ka_currentActiveTool=null}});ka_updateResults()} ;function ka_cleanupAll(){console.log("Kolla A11y: Cleaning up all elements...");const ka_toolbar=document.getElementById(ka_toolbarId);const ka_styles=document.getElementById(ka_styleId);const ka_outputPanel=document.getElementById(ka_outputId);ka_toolbar&&ka_toolbar.remove();ka_styles&&ka_styles.remove();ka_outputPanel&&ka_outputPanel.remove();ka_deactivateTool(null,!0);ka_headingCheckData=[]}function ka_cleanupHeadings(){console.log("Kolla A11y: Removing Heading Highlights & Panel");document.querySelectorAll(`.${ka_prefix}-highlight-heading`).forEach(ka_el=>{ka_el.classList.remove(`${ka_prefix}-highlight-heading`);ka_el.style.removeProperty(`--${ka_prefix}-heading-level`)});const ka_panel=document.getElementById(ka_outputId);if(ka_panel){ka_panel.remove()};ka_headingCheckData=[]}function ka_cleanupImages(){console.log("Kolla A11y: Removing Image Info & Highlights");document.querySelectorAll(`img.${ka_prefix}-highlight-image, svg.${ka_prefix}-highlight-svg`).forEach(ka_el=>{ka_el.classList.remove(`${ka_prefix}-highlight-image`);ka_el.classList.remove(`${ka_prefix}-highlight-svg`);ka_el.style.removeProperty(`--${ka_prefix}-img-status`);ka_IMAGE_HIGHLIGHT_CLASSES.forEach(ka_cls=>ka_el.classList.remove(ka_cls))});const ka_panel=document.getElementById(ka_outputId);if(ka_panel){ka_panel.remove()}}function ka_deactivateTool(ka_toolToPreserve=null,ka_forceCleanup=!1){const ka_previouslyActiveTool=ka_currentActiveTool;if(!ka_previouslyActiveTool&&!ka_forceCleanup)return;console.log(`Kolla A11y: Deactivating visual tool: ${ka_previouslyActiveTool}, Preserving: ${ka_toolToPreserve}, Force: ${ka_forceCleanup}`);if(ka_previouslyActiveTool&&(ka_forceCleanup||ka_previouslyActiveTool!==ka_toolToPreserve)){console.log(`Kolla A11y: Running cleanup actions for ${ka_previouslyActiveTool}`);switch(ka_previouslyActiveTool){case"headings":ka_cleanupHeadings();break;case"landmarks":ka_cleanupLandmarks();break;case"images":ka_cleanupImages();break;case"links":ka_cleanupLinks();break;case"focusable":ka_cleanupFocusable();break;case"contrast":ka_cleanupContrastCheck();break}if(ka_previouslyActiveTool!=="togglecss"){const ka_previousButton=document.querySelector(`#${ka_toolbarId} button[data-tool="${ka_previouslyActiveTool}"]`);if(ka_previousButton){ka_previousButton.setAttribute("aria-pressed","false")}}}if(ka_forceCleanup){console.log("Kolla A11y: Force cleanup invoked.");ka_currentActiveTool=null}else{ka_currentActiveTool=(ka_toolToPreserve!=="togglecss")?ka_toolToPreserve:null}console.log(`Kolla A11y: Deactivation finished. Current active tool state: ${ka_currentActiveTool}`)}function ka_getElementVisibility(ka_element){try{const ka_styles=window.getComputedStyle(ka_element);if(ka_styles.display==="none"||ka_styles.visibility==="hidden"||ka_element.closest('[aria-hidden="true"]')||ka_element.hidden)return"hidden";const ka_rect=ka_element.getBoundingClientRect();if((ka_rect.width===0||ka_rect.height===0)&&ka_styles.overflow!=="hidden"&&ka_styles.position==="absolute")return"visually-hidden";if((ka_rect.width===0||ka_rect.height===0)&&ka_styles.clip==="rect(0px, 0px, 0px, 0px)")return"visually-hidden";if(ka_rect.width===0||ka_rect.height===0)return"visually-hidden"}catch(ka_e){console.warn("Kolla A11y: Error checking visibility",ka_element,ka_e);return"hidden"}return"visible"}function ka_renderHeadingsList(ka_data,ka_filter){let ka_listHtml=`<ul aria-labelledby="${ka_prefix}-headings-list-title">`;let ka_visibleCount=0;let ka_h1Count=0;ka_data.forEach(ka_heading=>{const ka_visibility=ka_heading.visibility;let ka_shouldDisplay=!1;switch(ka_filter){case"visible":ka_shouldDisplay=(ka_visibility==="visible");break;case"hidden":ka_shouldDisplay=(ka_visibility==="hidden"||ka_visibility==="visually-hidden");break;default:ka_shouldDisplay=!0}if(ka_shouldDisplay){const ka_errorClass=ka_heading.issues.length>0?` ${ka_prefix}-heading-error`:"";let ka_listItem=`<li style="--level: ${ka_heading.level};" class="${ka_errorClass.trim()}">`;ka_listItem+=`<span class="kolla-a11y-heading-level">H${ka_heading.level}:</span> `;ka_listItem+=`<a href="#" class="kolla-a11y-heading-text" data-target-id="${ka_heading.targetId}">${ka_heading.text||"[Empty]"}</a>`;if(ka_heading.issues.length>0){ka_listItem+=` <span class="kolla-a11y-issue">(${ka_heading.issues.join(", ")})</span>`}if(ka_visibility==="visually-hidden"||ka_visibility==="hidden"){ka_listItem+=` <span class="kolla-a11y-hidden-info">[${ka_visibility.replace("-"," ")}]</span>`}ka_listItem+="</li>";ka_listHtml+=ka_listItem;ka_visibleCount++}if(ka_heading.level===1){ka_h1Count++}});ka_listHtml+="</ul>";if(ka_visibleCount===0&&ka_filter!=="all"){ka_listHtml+=`<p>No headings match the filter: "${ka_filter}".</p>`}if(ka_h1Count===0&&ka_filter!=="hidden"){ka_listHtml+=`<p class="${ka_prefix}-issue" style="margin-top: 10px;">Warning: No H1 heading found${ka_visibleCount>0?" among matching headings":""}.</p>`}return ka_listHtml}function ka_runHeadingsCheck(){console.log("Kolla A11y: Running Headings Check...");ka_cleanupHeadings();ka_headingCheckData=[];const ka_headings=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6"));let ka_previousLevel=0;let ka_h1TotalCount=0;ka_headings.forEach((ka_heading,ka_index)=>{if(ka_heading.closest(`#${ka_toolbarId}`)||ka_heading.closest(`#${ka_outputId}`))return;const ka_level=parseInt(ka_heading.tagName.substring(1),10);ka_heading.style.setProperty(`--${ka_prefix}-heading-level`,`"H${ka_level}"`);const ka_text=(ka_heading.textContent||"").trim();const ka_targetId=`${ka_prefix}-heading-${ka_index}`;ka_heading.setAttribute("data-kolla-a11y-id",ka_targetId);ka_heading.classList.add(`${ka_prefix}-highlight-heading`);let ka_issues=[];if(ka_level===1){ka_h1TotalCount++;if(ka_h1TotalCount>1){ka_issues.push("Multiple H1")}}else if(ka_index>0&&ka_level>ka_previousLevel+1){if(ka_previousLevel>0){ka_issues.push(`Skipped level (previous was H${ka_previousLevel}`)}}if(ka_text===""){ka_issues.push("Empty Heading")}const ka_visibility=ka_getElementVisibility(ka_heading);ka_headingCheckData.push({level:ka_level,text:ka_text,targetId:ka_targetId,issues:ka_issues,visibility:ka_visibility});if(ka_visibility!=="hidden"){ka_previousLevel=ka_level}});const ka_panelCloseBtnId=`${ka_outputId}-close-btn`;const ka_listContainerId=`${ka_prefix}-headings-list-container`;const ka_listTitleId=`${ka_prefix}-headings-list-title`;let ka_panelHtml=`<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><h3 id="${ka_prefix}-panel-title" style="margin: 0;">Headings Outline</h3><button id="${ka_panelCloseBtnId}" aria-label="Close Headings Outline Panel" class="${ka_prefix}-panel-close-btn">×</button></div>`;ka_panelHtml+=`<fieldset class="${ka_prefix}-filter-group"><legend class="${ka_prefix}-visually-hidden">Filter headings by visibility</legend><label><input type="radio" name="${ka_prefix}-heading-filter" value="all" ${ka_headingCheckFilter==="all"?"checked":""}> All</label><label><input type="radio" name="${ka_prefix}-heading-filter" value="visible" ${ka_headingCheckFilter==="visible"?"checked":""}> Visible Only</label><label><input type="radio" name="${ka_prefix}-heading-filter" value="hidden" ${ka_headingCheckFilter==="hidden"?"checked":""}> Hidden Only</label></fieldset>`;ka_panelHtml+=`<h4 id="${ka_listTitleId}" class="${ka_prefix}-visually-hidden">List of page headings with structure analysis</h4>`;ka_panelHtml+=`<div id="${ka_listContainerId}"></div>`;const ka_panelElement=document.createElement("div");ka_panelElement.id=ka_outputId;ka_panelElement.innerHTML=ka_panelHtml;document.body.appendChild(ka_panelElement);const ka_listContainer=document.getElementById(ka_listContainerId);ka_listContainer.innerHTML=ka_renderHeadingsList(ka_headingCheckData,ka_headingCheckFilter);ka_panelElement.addEventListener("click",ka_event=>{const ka_headingLink=ka_event.target.closest(".kolla-a11y-heading-text");if(ka_headingLink&&ka_headingLink.dataset.targetId){ka_event.preventDefault();const ka_targetElement=document.querySelector(`[data-kolla-a11y-id="${ka_headingLink.dataset.targetId}"]`);if(ka_targetElement){ka_targetElement.setAttribute("tabindex","-1");ka_targetElement.focus({preventScroll:!0});ka_targetElement.removeAttribute("tabindex");ka_targetElement.scrollIntoView({behavior:"smooth",block:"center"})}return}const ka_closeButton=ka_event.target.closest(`.${ka_prefix}-panel-close-btn`);if(ka_closeButton){ka_event.preventDefault();ka_cleanupHeadings();const ka_headingToolButton=document.querySelector(`#${ka_toolbarId} button[data-tool="headings"]`);if(ka_headingToolButton)ka_headingToolButton.setAttribute("aria-pressed","false");ka_currentActiveTool=null;return}if(ka_event.target.type==="radio"&&ka_event.target.name===`${ka_prefix}-heading-filter`){ka_headingCheckFilter=ka_event.target.value;console.log("Kolla A11y: Filter changed to",ka_headingCheckFilter);ka_listContainer.innerHTML=ka_renderHeadingsList(ka_headingCheckData,ka_headingCheckFilter)}})}function ka_getSvgAccessibleName(ka_svgElement){if(ka_svgElement.getAttribute("aria-hidden")==="true")return{name:"[Hidden by aria-hidden]",type:"hidden",statusClass:"hidden",statusText:"HIDDEN"};if(ka_svgElement.getAttribute("role")==="presentation")return{name:"[Marked as decorative]",type:"decorative",statusClass:"decorative",statusText:"DECO"};const ka_label=ka_svgElement.getAttribute("aria-label");if(ka_label)return{name:ka_label,type:"aria-label",statusClass:"named",statusText:"NAME"};const ka_labelledby=ka_svgElement.getAttribute("aria-labelledby");if(ka_labelledby){try{const ka_labelElement=document.getElementById(ka_labelledby);if(ka_labelElement)return{name:(ka_labelElement.textContent||"").trim(),type:"aria-labelledby",statusClass:"named",statusText:"NAME"}}catch(ka_e){console.warn("Kolla A11y: Error finding labelledby element",ka_labelledby,ka_e)}}const ka_titleElement=ka_svgElement.querySelector(":scope > title");if(ka_titleElement)return{name:(ka_titleElement.textContent||"").trim(),type:"title",statusClass:"named",statusText:"NAME"};if(ka_svgElement.getAttribute("role")==="img")return{name:null,type:"missing",statusClass:"missing",statusText:"NO NAME"};return{name:"[No explicit name or role=\"img\"]",type:"unclear",statusClass:"unclear",statusText:"???"}}function ka_runImagesCheck(){console.log("Kolla A11y: Running Images Check...");ka_cleanupImages();const ka_images=Array.from(document.querySelectorAll("img")),ka_svgs=Array.from(document.querySelectorAll("svg")),ka_outputItems=[];let ka_imgCount=0,ka_svgCount=0,ka_missingAltCount=0,ka_emptyAltCount=0,ka_missingSvgNameCount=0;ka_images.forEach((ka_img,ka_index)=>{if(ka_img.closest(`#${ka_toolbarId}`)||ka_img.closest(`#${ka_outputId}`))return;ka_imgCount++;const ka_targetId=`${ka_prefix}-image-${ka_index}`;ka_img.setAttribute("data-kolla-a11y-id",ka_targetId);ka_img.classList.add(`${ka_prefix}-highlight-image`);const ka_src=ka_img.getAttribute("src")||"[No src]";let ka_altText="",ka_altState="present",ka_issueMsg=null,ka_statusClass="",ka_statusText="";if(ka_img.hasAttribute("alt")){ka_altText=ka_img.getAttribute("alt");if(ka_altText.trim()===""){ka_altState="empty";ka_altText="[Empty alt]";ka_emptyAltCount++;ka_statusClass=`${ka_prefix}-highlight-image-alt-empty`;ka_statusText='ALT=""'}else{ka_altState="present";ka_statusClass=`${ka_prefix}-highlight-image-alt-present`;ka_statusText="ALT"}}else{ka_altState="missing";ka_altText="[Missing alt!]";ka_issueMsg="Missing alt attribute!";ka_missingAltCount++;ka_statusClass=`${ka_prefix}-highlight-image-alt-missing`;ka_statusText="NO ALT"}ka_img.classList.add(ka_statusClass);ka_img.style.setProperty(`--${ka_prefix}-img-status`,`'${ka_statusText}'`);ka_outputItems.push({type:"img",targetId:ka_targetId,src:ka_src,altText:ka_altText,altState:ka_altState,issue:ka_issueMsg})});ka_svgs.forEach((ka_svg,ka_index)=>{if(ka_svg.closest(`#${ka_toolbarId}`)||ka_svg.closest(`#${ka_outputId}`))return;const ka_rect=ka_svg.getBoundingClientRect();if(ka_rect.width<5&&ka_rect.height<5&&!ka_svg.hasAttribute("role"))return;ka_svgCount++;const ka_targetId=`${ka_prefix}-svg-${ka_index}`;ka_svg.setAttribute("data-kolla-a11y-id",ka_targetId);ka_svg.classList.add(`${ka_prefix}-highlight-svg`);const ka_accessibleInfo=ka_getSvgAccessibleName(ka_svg);let ka_issueMsg=null;if(ka_accessibleInfo.type==="missing"){ka_issueMsg='SVG has role="img" but no accessible name found!';ka_missingSvgNameCount++}else if(ka_accessibleInfo.type==="unclear"){ka_issueMsg="SVG has no explicit role or name. Verify purpose."}ka_svg.classList.add(`${ka_prefix}-highlight-svg-${ka_accessibleInfo.statusClass}`);ka_svg.style.setProperty(`--${ka_prefix}-img-status`,`'${ka_accessibleInfo.statusText}'`);ka_outputItems.push({type:"svg",targetId:ka_targetId,altText:ka_accessibleInfo.name,altState:ka_accessibleInfo.type,issue:ka_issueMsg})});const ka_panelCloseBtnId=`${ka_outputId}-close-btn`;let ka_panelHtml=`<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;"><h3 id="${ka_prefix}-panel-title" style="margin: 0;">Images & SVGs</h3><button id="${ka_panelCloseBtnId}" aria-label="Close Images Panel" class="${ka_prefix}-panel-close-btn">×</button></div>`;ka_panelHtml+=`<div class="${ka_prefix}-info-header">Found: ${ka_imgCount} img, ${ka_svgCount} relevant svg. Issues: ${ka_missingAltCount} missing alt, ${ka_emptyAltCount} empty alt, ${ka_missingSvgNameCount} SVG name missing.</div>`;ka_panelHtml+=`<div id="${ka_prefix}-list-container">`;if(ka_outputItems.length===0){ka_panelHtml+='<p>No relevant images or SVGs found on this page.</p>'}else{ka_outputItems.forEach(ka_item=>{ka_panelHtml+=`<div class="kolla-a11y-image-item">`;ka_panelHtml+=`<div class="kolla-a11y-image-preview" data-target-id="${ka_item.targetId}" title="Click to scroll to element">`;if(ka_item.type==="img"){if(ka_item.src==="[No src]"){ka_panelHtml+=`<span class="${ka_prefix}-no-src-preview">[No src]</span>`}else{ka_panelHtml+=`<img src="${ka_item.src}" alt="Preview" loading="lazy">`}}else{try{const ka_svgElement=document.querySelector(`[data-kolla-a11y-id="${ka_item.targetId}"]`);if(ka_svgElement){const ka_clone=ka_svgElement.cloneNode(!0);ka_clone.removeAttribute("width");ka_clone.removeAttribute("height");ka_clone.removeAttribute("style");ka_clone.removeAttribute("class");ka_panelHtml+=ka_clone.outerHTML}else{ka_panelHtml+="SVG"}}catch(ka_e){console.warn("Kolla A11y: Error cloning SVG for preview",ka_item.targetId,ka_e);ka_panelHtml+="SVG"}}ka_panelHtml+=`</div>`;ka_panelHtml+=`<div class="kolla-a11y-image-info">`;if(ka_item.type==="img"){ka_panelHtml+=`<strong>Alt Text:</strong>`;ka_panelHtml+=`<div class="kolla-a11y-image-alt ${ka_item.altState==="missing"||ka_item.altState==="empty"?ka_prefix+"-heading-error":""}">${ka_item.altText}</div>`;ka_panelHtml+=`<div class="kolla-a11y-image-src">Src: ${ka_item.src}</div>`}else{ka_panelHtml+=`<strong>Accessible Name (${ka_item.altState}):</strong>`;ka_panelHtml+=`<div class="kolla-a11y-svg-name ${ka_item.altState==="missing"||ka_item.altState==="unclear"?ka_prefix+"-heading-error":""}">${ka_item.altText||"[None]"}</div>`}if(ka_item.issue){ka_panelHtml+=`<div class="kolla-a11y-issue">(${ka_item.issue})</div>`}ka_panelHtml+=`</div>`;ka_panelHtml+=`</div>`})}ka_panelHtml+=`</div>`;const ka_panelElement=document.createElement("div");ka_panelElement.id=ka_outputId;ka_panelElement.innerHTML=ka_panelHtml;document.body.appendChild(ka_panelElement);ka_panelElement.addEventListener("click",ka_event=>{const ka_targetId=ka_event.target.closest("[data-target-id]")?.dataset.targetId;if(ka_targetId){ka_event.preventDefault();const ka_targetElement=document.querySelector(`[data-kolla-a11y-id="${ka_targetId}"]`);if(ka_targetElement){ka_targetElement.setAttribute("tabindex","-1");ka_targetElement.focus({preventScroll:!0});ka_targetElement.removeAttribute("tabindex");ka_targetElement.scrollIntoView({behavior:"smooth",block:"center"})}return}const ka_closeButton=ka_event.target.closest(`.${ka_prefix}-panel-close-btn`);if(ka_closeButton){ka_event.preventDefault();ka_cleanupImages();const ka_imageToolButton=document.querySelector(`#${ka_toolbarId} button[data-tool="images"]`);if(ka_imageToolButton)ka_imageToolButton.setAttribute("aria-pressed","false");ka_currentActiveTool=null}})}function ka_getAccessibleName(ka_element){const ka_labelledby=ka_element.getAttribute("aria-labelledby");if(ka_labelledby){const ka_ids=ka_labelledby.split(/\s+/).filter(Boolean);let ka_name="";return ka_ids.forEach(ka_id=>{try{const ka_labelElement=document.getElementById(ka_id);if(ka_labelElement)ka_name+=(ka_labelElement.textContent||"").trim()+" "}catch(ka_e){console.warn("Kolla A11y: Error finding labelledby ID:",ka_id,ka_e)}}),ka_name=ka_name.trim(),ka_name?ka_name:null}const ka_label=ka_element.getAttribute("aria-label");if(ka_label&&ka_label.trim())return ka_label.trim();const ka_titleAttr=ka_element.getAttribute("title");if(ka_titleAttr&&ka_titleAttr.trim())return ka_titleAttr.trim();const ka_role=ka_element.getAttribute("role");const ka_tagName=ka_element.tagName.toLowerCase();if("banner"===ka_role||"header"===ka_tagName&&!ka_element.closest("section, article, aside, nav, main"))return"Banner";if("contentinfo"===ka_role||"footer"===ka_tagName&&!ka_element.closest("section, article, aside, nav, main"))return"Content Information";if("main"===ka_role||"main"===ka_tagName)return"Main Content";if(("form"===ka_role||"form"===ka_tagName)&&!ka_label&&!ka_labelledby){const ka_legend=ka_element.querySelector("legend");if(ka_legend)return(ka_legend.textContent||"").trim()}return null}function ka_getAccessibleLinkText(ka_linkElement){const ka_labelledby=ka_linkElement.getAttribute("aria-labelledby");if(ka_labelledby){try{const ka_labelElement=document.getElementById(ka_labelledby);if(ka_labelElement)return(ka_labelElement.textContent||"").trim()}catch(ka_e){console.warn("Kolla A11y: Error finding labelledby for link",ka_labelledby,ka_e)}}const ka_label=ka_linkElement.getAttribute("aria-label");if(ka_label)return ka_label.trim();let ka_textContent="";Array.from(ka_linkElement.childNodes).forEach(ka_node=>{if(ka_node.nodeType===Node.TEXT_NODE)ka_textContent+=ka_node.textContent;else if(ka_node.nodeType===Node.ELEMENT_NODE){const ka_style=window.getComputedStyle(ka_node);ka_style.display!=="none"&&ka_style.visibility!=="hidden"&&!ka_node.closest('[aria-hidden="true"]')&&(ka_textContent+=ka_node.textContent)}});ka_textContent=ka_textContent.replace(/\s+/g," ").trim();if(ka_textContent)return ka_textContent;const ka_img=ka_linkElement.querySelector(":scope > img");if(ka_img&&ka_img.hasAttribute("alt")){const ka_alt=ka_img.getAttribute("alt").trim();return ka_alt||"[Image with empty alt]"}if(ka_img&&!ka_img.hasAttribute("alt"))return"[Image missing alt]";const ka_svg=ka_linkElement.querySelector(":scope > svg");if(ka_svg){const ka_svgInfo=ka_getSvgAccessibleName(ka_svg);if(ka_svgInfo.name&&ka_svgInfo.type!=="unclear")return ka_svgInfo.name;if(ka_svgInfo.type==="missing")return"[SVG role=img missing name]"}return"[Empty or non-text content]"}function ka_getSkipLinkStatus(ka_pageLang){const ka_result={found:!1,text:"",href:"",targetExists:!1,message:"No potential skip link found near the top of the page."},ka_potentialSkipLinks=Array.from(document.querySelectorAll("body > a[href^=\"#\"]:first-of-type, body > div:first-of-type a[href^=\"#\"]:first-of-type, body > :first-child a[href^=\"#\"]:first-of-type")).slice(0,5),ka_skipPhrases=ka_SKIP_LINK_TEXT[ka_pageLang]||ka_SKIP_LINK_TEXT.en;for(const ka_link of ka_potentialSkipLinks){const ka_linkText=(ka_link.textContent||"").trim().toLowerCase();if(ka_skipPhrases.some(ka_phrase=>ka_linkText.includes(ka_phrase))){ka_result.found=!0,ka_result.text=(ka_link.textContent||"").trim(),ka_result.href=ka_link.getAttribute("href");try{const ka_targetId=ka_result.href.substring(1);ka_result.targetExists=!!document.getElementById(ka_targetId)}catch(ka_e){ka_result.targetExists=!1}ka_result.message=ka_result.targetExists?`✅ Found potential skip link: "${ka_result.text}" targeting ${ka_result.href}. Target exists.`:`⚠️ Found potential skip link: "${ka_result.text}" targeting ${ka_result.href}. TARGET DOES NOT EXIST or has invalid ID!`;return ka_result}}ka_result.message="ℹ️ No link matching common skip link text found near the top of the page.";return ka_result}function ka_activateTool(ka_toolName,ka_buttonElement){console.log(`Kolla A11y: Received activation request for: ${ka_toolName}`);const ka_isCurrentlyPressed=ka_buttonElement.getAttribute("aria-pressed")==="true";if(ka_isCurrentlyPressed&&ka_toolName===ka_currentActiveTool){console.log(`Kolla A11y: Deactivating ${ka_toolName} by clicking again.`);ka_deactivateTool(null);return}console.log(`Kolla A11y: Activating new tool ${ka_toolName}. Current active: ${ka_currentActiveTool}`);if(ka_currentActiveTool&&ka_currentActiveTool!==ka_toolName){console.log(`Kolla A11y: Deactivating previous tool ${ka_currentActiveTool} before activating ${ka_toolName}.`);ka_deactivateTool(ka_toolName)}console.log(`Kolla A11y: Setting ${ka_toolName} button to pressed and running its function.`);ka_buttonElement.setAttribute("aria-pressed","true");ka_currentActiveTool=ka_toolName;switch(ka_toolName){case"headings":ka_runHeadingsCheck();break;case"images":ka_runImagesCheck();break;case"links":ka_runLinksCheck();break;case"landmarks":ka_runLandmarksCheck();break;case"focusable":ka_runFocusableCheck();break;case"contrast":ka_runContrastCheck();break}console.log(`Kolla A11y: Activation finished for ${ka_toolName}.`)}function ka_hexToRgb(ka_hex){if(!ka_hex||typeof ka_hex!=="string")return null;let ka_cleanHex=ka_hex.startsWith("#")?ka_hex.slice(1):ka_hex;if(!/^[0-9a-fA-F]+$/.test(ka_cleanHex))return null;if(ka_cleanHex.length===3){ka_cleanHex=ka_cleanHex.split("").map(ka_char=>ka_char+ka_char).join("")}if(ka_cleanHex.length!==6)return null;const ka_r=parseInt(ka_cleanHex.substring(0,2),16);const ka_g=parseInt(ka_cleanHex.substring(2,4),16);const ka_b=parseInt(ka_cleanHex.substring(4,6),16);return{r:ka_r,g:ka_g,b:ka_b}}function ka_rgbToHex(ka_rgb){if(!ka_rgb)return"#000000";const ka_toHex=ka_c=>("0"+ka_c.toString(16)).slice(-2);return`#${ka_toHex(ka_rgb.r)}${ka_toHex(ka_rgb.g)}${ka_toHex(ka_rgb.b)}`}function ka_parseRgbString(ka_rgbString){if(!ka_rgbString||!ka_rgbString.toLowerCase().startsWith("rgb"))return null;const ka_match=ka_rgbString.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*([\d.]+))?\)/i);if(!ka_match)return null;return{r:parseInt(ka_match[1],10),g:parseInt(ka_match[2],10),b:parseInt(ka_match[3],10),a:ka_match[4]!==undefined?parseFloat(ka_match[4]):1}}function ka_blendColors(ka_fgRgba,ka_bgRgb){if(ka_fgRgba.a===1)return{r:ka_fgRgba.r,g:ka_fgRgba.g,b:ka_fgRgba.b};if(ka_fgRgba.a===0)return ka_bgRgb;const ka_alpha=ka_fgRgba.a;const ka_invAlpha=1-ka_alpha;return{r:Math.round(ka_alpha*ka_fgRgba.r+ka_invAlpha*ka_bgRgb.r),g:Math.round(ka_alpha*ka_fgRgba.g+ka_invAlpha*ka_bgRgb.g),b:Math.round(ka_alpha*ka_fgRgba.b+ka_invAlpha*ka_bgRgb.b)}}function ka_getEffectiveBackgroundColor(ka_element){let ka_currentElement=ka_element;for(let ka_i=0;ka_i<5&&ka_currentElement;ka_i++){const ka_style=window.getComputedStyle(ka_currentElement);const ka_bgColor=ka_style.backgroundColor;const ka_bgRgba=ka_parseRgbString(ka_bgColor);if(ka_bgRgba&&ka_bgRgba.a>0){if(ka_bgRgba.a===1)return ka_bgRgba;const ka_parentBg=ka_getEffectiveBackgroundColor(ka_currentElement.parentElement)||(ka_i===4?{r:255,g:255,b:255}:null);if(ka_parentBg)return ka_blendColors(ka_bgRgba,ka_parentBg)}if(ka_style.backgroundImage!=="none")return null;ka_currentElement=ka_currentElement.parentElement}return{r:255,g:255,b:255}}function ka_getRelativeLuminance(ka_rgb){if(!ka_rgb)return 0;const ka_rsrgb=ka_rgb.r/255;const ka_gsrgb=ka_rgb.g/255;const ka_bsrgb=ka_rgb.b/255;const ka_r=ka_rsrgb<=.03928?ka_rsrgb/12.92:((ka_rsrgb+.055)/1.055)**2.4;const ka_g=ka_gsrgb<=.03928?ka_gsrgb/12.92:((ka_gsrgb+.055)/1.055)**2.4;const ka_b=ka_bsrgb<=.03928?ka_bsrgb/12.92:((ka_bsrgb+.055)/1.055)**2.4;return.2126*ka_r+.7152*ka_g+.0722*ka_b}function ka_getContrastRatio(ka_rgb1,ka_rgb2){const ka_lum1=ka_getRelativeLuminance(ka_rgb1);const ka_lum2=ka_getRelativeLuminance(ka_rgb2);const ka_lighter=Math.max(ka_lum1,ka_lum2);const ka_darker=Math.min(ka_lum1,ka_lum2);return(ka_lighter+.05)/(ka_darker+.05)}function ka_checkWcagContrast(ka_ratio){return{aaNormal:ka_ratio>=ka_WCAG_THRESHOLDS.AA_NORMAL,aaLargeUI:ka_ratio>=ka_WCAG_THRESHOLDS.AA_LARGE_UI,aaaNormal:ka_ratio>=ka_WCAG_THRESHOLDS.AAA_NORMAL,aaaLarge:ka_ratio>=ka_WCAG_THRESHOLDS.AAA_LARGE}}function ka_runAutomatedContrastScan(){const ka_scanResultsContainer=document.getElementById(`${ka_prefix}-scan-results`);const ka_scanButton=document.getElementById(`${ka_prefix}-scan-button`);ka_scanResultsContainer.innerHTML='<p>Scanning page... (This may take a moment)</p>';ka_scanButton.disabled=!0;setTimeout(()=>{const ka_elementsToScan=Array.from(document.querySelectorAll("p, span, a, h1, h2, h3, h4, h5, h6, li, dd, dt, button, [role=button], input[type=button], input[type=submit], summary"));const ka_issuesFound=[];ka_elementsToScan.forEach((ka_el,ka_index)=>{if(ka_el.closest(`#${ka_toolbarId}, #${ka_outputId}`))return;const ka_style=window.getComputedStyle(ka_el);const ka_text=(ka_el.textContent||"").trim();if(!ka_text)return;if(ka_getElementVisibility(ka_el)!=='visible')return;const ka_rect=ka_el.getBoundingClientRect();if(ka_rect.width<1||ka_rect.height<1)return;const ka_fgColorString=ka_style.color;const ka_fgRgba=ka_parseRgbString(ka_fgColorString);if(!ka_fgRgba)return;const ka_bgRgb=ka_getEffectiveBackgroundColor(ka_el);if(!ka_bgRgb)return;const ka_finalFgRgb=ka_blendColors(ka_fgRgba,ka_bgRgb);const ka_ratio=ka_getContrastRatio(ka_finalFgRgb,ka_bgRgb);const ka_fontSize=parseInt(ka_style.fontSize,10);const ka_fontWeight=ka_style.fontWeight;const ka_isLargeText=(ka_fontSize>=24||(ka_fontSize>=18.67&&(ka_fontWeight==="bold"||ka_fontWeight>="700")));const ka_requiredRatio=ka_isLargeText?ka_WCAG_THRESHOLDS.AA_LARGE_UI:ka_WCAG_THRESHOLDS.AA_NORMAL;if(ka_ratio<ka_requiredRatio){const ka_targetId=`${ka_prefix}-contrast-issue-${ka_index}`;ka_el.setAttribute("data-kolla-a11y-id",ka_targetId);ka_el.classList.add(`${ka_prefix}-highlight-contrast-issue`);ka_issuesFound.push({targetId:ka_targetId,textSnippet:ka_text.substring(0,50)+(ka_text.length>50?"...":""),fgHex:ka_rgbToHex(ka_finalFgRgb),bgHex:ka_rgbToHex(ka_bgRgb),ratio:ka_ratio.toFixed(2),elementTag:ka_el.tagName.toLowerCase()})}});let ka_resultHtml='<h4>Automated Scan Results (Simplified)</h4>';if(ka_issuesFound.length>0){ka_resultHtml+=`<p>Found ${ka_issuesFound.length} potential low contrast text elements (below AA):</p><ul>`;ka_issuesFound.forEach(ka_issue=>{ka_resultHtml+=`<li class="${ka_prefix}-contrast-issue-item"> <a href="#" data-target-id="${ka_issue.targetId}" title="Click to scroll"> <span class="${ka_prefix}-contrast-issue-tag"><${ka_issue.elementTag}></span> "${ka_issue.textSnippet}" </a> <div class="${ka_prefix}-contrast-issue-details"> Ratio: <strong>${ka_issue.ratio}:1</strong> | FG: <span style="color:${ka_issue.fgHex};background-color:${ka_issue.bgHex};padding:0 3px;border:1px solid #ccc;">${ka_issue.fgHex}</span> | BG: <span style="color:${ka_issue.bgHex};background-color:${ka_issue.fgHex};padding:0 3px;border:1px solid #ccc;">${ka_issue.bgHex}</span> </div> </li>`});ka_resultHtml+="</ul>"}else{ka_resultHtml+='<p>✅ No obvious low contrast text issues found (based on simplified scan).</p>'}ka_resultHtml+=`<p class="${ka_prefix}-contrast-disclaimer"><strong>Note:</strong> This scan is simplified and may miss issues with gradients, images, or complex overlaps. Manual verification is recommended.</p>`;ka_scanResultsContainer.innerHTML=ka_resultHtml;ka_scanButton.disabled=!1},10)}function ka_runContrastCheck(){console.log("Kolla A11y: Running Contrast Check...");ka_cleanupContrastCheck();const ka_panelCloseBtnId=`${ka_outputId}-close-btn`;const ka_panelHtml=`<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;"> <h3 id="${ka_prefix}-panel-title" style="margin: 0;">Color Contrast Checker</h3> <button id="${ka_panelCloseBtnId}" aria-label="Close Contrast Panel" class="${ka_prefix}-panel-close-btn">×</button> </div> <div class="${ka_prefix}-contrast-section"> <h4>Manual Checker</h4> <div class="${ka_prefix}-contrast-inputs"> <div class="${ka_prefix}-contrast-group"> <label for="${ka_prefix}-fg-hex">Foreground</label> <div class="${ka_prefix}-contrast-input-row"> <input type="text" id="${ka_prefix}-fg-hex" value="#ffffff" pattern="#?[0-9a-fA-F]{3,6}"> <input type="color" id="${ka_prefix}-fg-picker" value="#ffffff" aria-label="Foreground color picker"> </div> </div> <div class="${ka_prefix}-contrast-group"> <label for="${ka_prefix}-bg-hex">Background</label> <div class="${ka_prefix}-contrast-input-row"> <input type="text" id="${ka_prefix}-bg-hex" value="#000000" pattern="#?[0-9a-fA-F]{3,6}"> <input type="color" id="${ka_prefix}-bg-picker" value="#000000" aria-label="Background color picker"> </div> </div> </div> <div class="${ka_prefix}-contrast-results"> <div class="${ka_prefix}-contrast-ratio"> Contrast Ratio: <strong id="${ka_prefix}-contrast-value">-.-- : 1</strong> </div> <div id="${ka_prefix}-contrast-details"> <h5>AA Requirements</h5> <div class="${ka_prefix}-contrast-result-line">Normal Text (≥ 4.5): <span id="${ka_prefix}-result-aa-normal">---</span></div> <div class="${ka_prefix}-contrast-result-line">Large Text / UI (≥ 3): <span id="${ka_prefix}-result-aa-large">---</span></div> <h5>AAA Requirements</h5> <div class="${ka_prefix}-contrast-result-line">Normal Text (≥ 7): <span id="${ka_prefix}-result-aaa-normal">---</span></div> <div class="${ka_prefix}-contrast-result-line">Large Text (≥ 4.5): <span id="${ka_prefix}-result-aaa-large">---</span></div> </div> </div> </div> <hr class="${ka_prefix}-contrast-hr"> <div class="${ka_prefix}-contrast-section"> <h4>Automated Scan (Simplified)</h4> <button id="${ka_prefix}-scan-button" class="${ka_prefix}-contrast-scan-btn">Scan Page for Low Contrast Text</button> <div id="${ka_prefix}-scan-results" class="${ka_prefix}-scan-results-area"></div> </div>`;const ka_panelElement=document.createElement("div");ka_panelElement.id=ka_outputId;ka_panelElement.innerHTML=ka_panelHtml;document.body.appendChild(ka_panelElement);const ka_fgHexInput=document.getElementById(`${ka_prefix}-fg-hex`);const ka_fgPicker=document.getElementById(`${ka_prefix}-fg-picker`);const ka_bgHexInput=document.getElementById(`${ka_prefix}-bg-hex`);const ka_bgPicker=document.getElementById(`${ka_prefix}-bg-picker`);const ka_contrastValueSpan=document.getElementById(`${ka_prefix}-contrast-value`);const ka_resultAaNormal=document.getElementById(`${ka_prefix}-result-aa-normal`);const ka_resultAaLarge=document.getElementById(`${ka_prefix}-result-aa-large`);const ka_resultAaaNormal=document.getElementById(`${ka_prefix}-result-aaa-normal`);const ka_resultAaaLarge=document.getElementById(`${ka_prefix}-result-aaa-large`);const ka_updateResults=()=>{const ka_fgHex=ka_fgHexInput.value;const ka_bgHex=ka_bgHexInput.value;const ka_fgRgb=ka_hexToRgb(ka_fgHex);const ka_bgRgb=ka_hexToRgb(ka_bgHex);if(!ka_fgRgb||!ka_bgRgb){ka_contrastValueSpan.textContent="Invalid Hex";ka_resultAaNormal.textContent="❌";ka_resultAaLarge.textContent="❌";ka_resultAaaNormal.textContent="❌";ka_resultAaaLarge.textContent="❌";return}const ka_ratio=ka_getContrastRatio(ka_fgRgb,ka_bgRgb);const ka_results=ka_checkWcagContrast(ka_ratio);ka_contrastValueSpan.textContent=`${ka_ratio.toFixed(2)} : 1`;ka_resultAaNormal.textContent=ka_results.aaNormal?"✅ Pass":"❌ Fail";ka_resultAaLarge.textContent=ka_results.aaLargeUI?"✅ Pass":"❌ Fail";ka_resultAaaNormal.textContent=ka_results.aaaNormal?"✅ Pass":"❌ Fail";ka_resultAaaLarge.textContent=ka_results.aaaLarge?"✅ Pass":"❌ Fail"};ka_fgHexInput.addEventListener("input",()=>{try{ka_fgPicker.value=ka_fgHexInput.value}catch(ka_e){}ka_updateResults()});ka_fgPicker.addEventListener("input",()=>{ka_fgHexInput.value=ka_fgPicker.value;ka_updateResults()});ka_bgHexInput.addEventListener("input",()=>{try{ka_bgPicker.value=ka_bgHexInput.value}catch(ka_e){}ka_updateResults()});ka_bgPicker.addEventListener("input",()=>{ka_bgHexInput.value=ka_bgPicker.value;ka_updateResults()});document.getElementById(`${ka_prefix}-scan-button`)?.addEventListener("click",ka_runAutomatedContrastScan);ka_panelElement.addEventListener("click",ka_event=>{const ka_targetId=ka_event.target.closest('[data-target-id]')?.dataset.targetId;if(ka_targetId){ka_event.preventDefault();const ka_targetElement=document.querySelector(`[data-kolla-a11y-id="${ka_targetId}"]`);if(ka_targetElement){ka_targetElement.focus({preventScroll:!0});ka_targetElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}return}const ka_closeButton=ka_event.target.closest(`.${ka_prefix}-panel-close-btn`);if(ka_closeButton){ka_event.preventDefault();ka_cleanupContrastCheck();const ka_contrastToolButton=document.querySelector(`#${ka_toolbarId} button[data-tool="contrast"]`);if(ka_contrastToolButton)ka_contrastToolButton.setAttribute("aria-pressed","false");ka_currentActiveTool=null}});ka_updateResults()} ;function ka_createToolbar(){const ka_css=`#${ka_toolbarId}{all:initial;position:fixed;top:0;left:0;width:100%;box-sizing:border-box;z-index:2147483647;background-color:#333;color:#fff;padding:8px 12px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:14px;line-height:1.5;display:flex;flex-wrap:wrap;gap:8px;align-items:center;border-bottom:1px solid #555;box-shadow:0 2px 5px rgba(0,0,0,.3);text-align:left}#${ka_toolbarId} *{box-sizing:border-box;font-family:inherit;font-size:inherit;line-height:inherit;color:inherit;margin:0;padding:0;border:0;background:none}#${ka_toolbarId} button{all:initial;display:inline-block;text-align:center;font-family:inherit;font-size:inherit;line-height:inherit;color:#fff;background-color:#555;border:1px solid #777;padding:5px 10px;cursor:pointer;border-radius:3px;transition:background-color .2s ease;white-space:nowrap}#${ka_toolbarId} button:focus-visible{outline:3px solid cyan!important;outline-offset:1px;box-shadow:0 0 0 3px rgba(0,150,255,.7)}#${ka_toolbarId} button:hover{background-color:#666}#${ka_toolbarId} button[aria-pressed=true]{background-color:#007bff;border-color:#0056b3;font-weight:bold}#${ka_toolbarId} button.${ka_prefix}-close{background-color:#dc3545;border-color:#bd2130;margin-left:auto;font-weight:bold;font-size:1.2em;padding:2px 8px;line-height:1}#${ka_toolbarId} button.${ka_prefix}-close:hover{background-color:#c82333}.${ka_prefix}-highlight-heading{outline:3px dashed magenta!important;outline-offset:2px;box-shadow:0 0 5px 2px rgba(255,0,255,.5)!important;background-color:rgba(255,0,255,.1)!important;scroll-margin-top:50px!important;position:relative}.${ka_prefix}-highlight-heading::before{content:var(--${ka_prefix}-heading-level,'?');position:absolute;top:-1.8em;left:-5px;background-color:magenta;color:#fff;font-size:10px;font-weight:bold;padding:2px 4px;border-radius:2px;z-index:1;line-height:1;font-family:sans-serif;display:inline-block;text-align:center;white-space:nowrap}.${ka_prefix}-visually-hidden{border:0!important;clip:rect(1px,1px,1px,1px)!important;height:1px!important;overflow:hidden!important;padding:0!important;position:absolute!important;width:1px!important;white-space:nowrap!important}#${ka_outputId}{all:initial;position:fixed;top:60px;right:10px;max-width:350px;max-height:80vh;overflow-y:auto;background-color:#fff;color:#111;border:1px solid #999;box-shadow:3px 3px 8px rgba(0,0,0,.3);padding:15px;z-index:2147483646;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:13px;line-height:1.6;border-radius:4px}#${ka_outputId} *{all:revert}#${ka_outputId} h3,#${ka_outputId} h4,#${ka_outputId} h5{margin:0 0 10px 0;padding-bottom:5px;font-size:1.1em;font-weight:bold;color:#333}#${ka_outputId} h4{font-size:1.05em;margin-top:15px;margin-bottom:8px;padding-bottom:3px;border-bottom:1px solid #ccc}#${ka_outputId} h5{font-size:1em;font-weight:bold;margin-top:10px;margin-bottom:5px;padding-bottom:0;border-bottom:none}#${ka_outputId} ul{list-style-type:none;padding-left:0;margin:0}#${ka_outputId} li{padding-left:calc((var(--level, 1) - 1) * 20px);margin-bottom:4px;white-space:normal}#${ka_outputId} .kolla-a11y-heading-level{display:inline-block;width:25px;font-weight:bold;color:#555}#${ka_outputId} .kolla-a11y-heading-text{cursor:pointer;text-decoration:none;color:#005a9c}#${ka_outputId} .kolla-a11y-heading-text:hover{text-decoration:underline}#${ka_outputId} .kolla-a11y-issue{font-weight:bold;color:red;margin-left:8px;font-size:.9em}#${ka_outputId} li.${ka_prefix}-heading-error{background-color:#ffebee;border-left:3px solid #e57373;padding-left:calc((var(--level, 1) - 1) * 20px + 5px);margin-left:-8px;padding-right:5px;margin-right:-5px;border-radius:3px}#${ka_outputId} li.${ka_prefix}-heading-error .kolla-a11y-issue{color:#c62828}.${ka_prefix}-panel-close-btn{all:initial;font-family:inherit;font-size:1.6em;line-height:1;color:#666;background:0 0;border:none;padding:0 5px;cursor:pointer;border-radius:3px}.${ka_prefix}-panel-close-btn:hover{color:#111;background-color:#ddd}.${ka_prefix}-panel-close-btn:focus-visible{outline:2px solid #005a9c;outline-offset:2px}.${ka_prefix}-filter-group{all:revert;border:1px solid #ccc;padding:5px 10px 8px 10px;margin:0 0 10px 0;display:block;border-radius:3px}.${ka_prefix}-filter-group legend{font-size:0.9em;font-weight:bold;padding:0 5px}.${ka_prefix}-filter-group label{margin-right:15px;font-size:0.95em;cursor:pointer;display:inline-flex;align-items:center}.${ka_prefix}-filter-group input[type=radio]{margin-right:5px;position:relative;top:-1px}.${ka_prefix}-hidden-info{font-style:italic;color:#757575;margin-left:8px;font-size:0.9em}.${ka_prefix}-highlight-image,.${ka_prefix}-highlight-svg{outline-offset:3px;position:relative;scroll-margin-top:50px!important}.${ka_prefix}-highlight-image::before,.${ka_prefix}-highlight-svg::before{content:var(--${ka_prefix}-img-status,'?');position:absolute;top:-1.5em;left:-5px;color:#fff;font-size:10px;font-weight:bold;padding:2px 4px;border-radius:2px;z-index:1;line-height:1;font-family:sans-serif;white-space:nowrap;text-align:center;min-width:2em;display:inline-block}.${ka_prefix}-highlight-image-alt-present::before{background-color:#4CAF50}.${ka_prefix}-highlight-image-alt-empty::before{background-color:#ff9800}.${ka_prefix}-highlight-image-alt-missing::before{background-color:#f44336}.${ka_prefix}-highlight-svg-named::before{background-color:#4CAF50}.${ka_prefix}-highlight-svg-decorative::before{background-color:#ff9800}.${ka_prefix}-highlight-svg-missing::before{background-color:#f44336}.${ka_prefix}-highlight-svg-unclear::before{background-color:#9e9e9e}.${ka_prefix}-highlight-svg-hidden::before{background-color:#9e9e9e}.${ka_prefix}-highlight-image{outline:3px dashed #007bff!important;position:relative;scroll-margin-top:50px!important}.${ka_prefix}-highlight-svg{outline:3px dashed #ff9800!important;position:relative;scroll-margin-top:50px!important}#${ka_outputId} .kolla-a11y-image-item{display:flex;align-items:flex-start;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #ddd}#${ka_outputId} .kolla-a11y-image-preview{flex:0 0 50px;height:50px;margin-right:10px;background-color:#eee;display:flex;align-items:center;justify-content:center;overflow:hidden;border:1px solid #ccc;cursor:pointer}#${ka_outputId} .kolla-a11y-image-preview img,#${ka_outputId} .kolla-a11y-image-preview svg{max-width:100%;max-height:100%;display:block}#${ka_outputId} .kolla-a11y-image-info{flex:1;font-size:.95em}#${ka_outputId} .kolla-a11y-image-info strong{color:#333;font-weight:bold}#${ka_outputId} .kolla-a11y-image-alt,#${ka_outputId} .kolla-a11y-svg-name{display:block;margin-top:2px;padding:3px 5px;background-color:#e9e9e9;border-radius:3px;word-wrap:break-word}#${ka_outputId} .kolla-a11y-image-alt.${ka_prefix}-heading-error,#${ka_outputId} .kolla-a11y-svg-name.${ka_prefix}-heading-error{background-color:#ffebee!important;border:1px solid #e57373}#${ka_outputId} .kolla-a11y-image-info .kolla-a11y-issue{display:block;margin-top:4px;font-size:.9em}#${ka_outputId} .kolla-a11y-image-src{font-size:.85em;color:#555;margin-top:4px;word-break:break-all}#${ka_outputId} .kolla-a11y-info-header{font-size:.9em;margin-bottom:15px;padding-bottom:5px;border-bottom:1px dashed #ccc;color:#444;display:block!important}.${ka_prefix}-no-src-preview{font-size:0.8em;color:#777;text-align:center}.${ka_prefix}-highlight-link,.${ka_prefix}-highlight-link-issue{outline:3px dashed #4CAF50!important;outline-offset:2px;position:relative;scroll-margin-top:50px!important}.${ka_prefix}-highlight-link-issue{outline-color:#ff9800!important;box-shadow:0 0 5px 2px rgba(255,152,0,.5)!important;background-color:rgba(255,152,0,.1)!important}.${ka_prefix}-highlight-link::before,.${ka_prefix}-highlight-link-issue::before{content:var(--${ka_prefix}-link-status,'LINK');position:absolute;top:-1.5em;left:-5px;color:#fff;font-size:10px;font-weight:bold;padding:2px 4px;border-radius:2px;z-index:1;line-height:1;font-family:sans-serif;white-space:nowrap;text-align:center;min-width:2em;display:inline-block;background-color:#4CAF50}.${ka_prefix}-highlight-link-issue::before{background-color:#ff9800}#${ka_outputId} .${ka_prefix}-link-item{margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #ddd}#${ka_outputId} .${ka_prefix}-link-text{display:block;margin-bottom:3px;font-weight:bold;word-wrap:break-word;cursor:pointer;color:#005a9c}#${ka_outputId} .${ka_prefix}-link-text:hover{text-decoration:underline}#${ka_outputId} .${ka_prefix}-link-href{font-size:.85em;color:#555;word-break:break-all}#${ka_outputId} .${ka_prefix}-link-item .${ka_prefix}-issue{display:block;margin-top:4px;font-size:.9em}#${ka_outputId} .${ka_prefix}-link-item.${ka_prefix}-heading-error{background-color:#fff3e0;border-left:3px solid #ffcc80;padding-left:5px;margin-left:-8px;padding-right:5px;margin-right:-5px;border-radius:3px}#${ka_outputId} .${ka_prefix}-link-item.${ka_prefix}-heading-error .${ka_prefix}-issue{color:#e65100}#${ka_outputId} .${ka_prefix}-skip-link-info{padding:10px;margin-bottom:15px;border:1px solid #ccc;border-radius:3px;background-color:#f9f9f9;font-size:.95em}#${ka_outputId} .${ka_prefix}-skip-link-info strong{display:block;margin-bottom:5px}#${ka_outputId} .${ka_prefix}-skip-link-info .${ka_prefix}-issue{margin-left:0;font-size:1em}.${ka_prefix}-highlight-landmark{outline:3px dashed #FFC107!important;outline-offset:2px;box-shadow:0 0 5px 2px rgba(255,193,7,.5)!important;background-color:rgba(255,193,7,.05)!important;scroll-margin-top:50px!important;position:relative}.${ka_prefix}-highlight-landmark::before{content:var(--${ka_prefix}-landmark-role,'LM');position:absolute;top:-1.5em;left:-5px;background-color:#FFC107;color:#000;font-size:10px;font-weight:bold;padding:2px 4px;border-radius:2px;z-index:1;line-height:1;font-family:sans-serif;white-space:nowrap;text-align:center;min-width:2em;display:inline-block;text-transform:uppercase}#${ka_outputId} .${ka_prefix}-landmark-item{margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #ddd}#${ka_outputId} .${ka_prefix}-landmark-role{display:block;font-weight:bold;margin-bottom:2px;text-transform:capitalize;cursor:pointer}#${ka_outputId} .${ka_prefix}-landmark-role:hover{text-decoration:underline}#${ka_outputId} .${ka_prefix}-landmark-name{font-size:.9em;color:#333;margin-bottom:4px;display:block;padding:2px 4px;background-color:#eee;border-radius:2px;word-wrap:break-word}#${ka_outputId} .${ka_prefix}-landmark-element{font-size:.85em;color:#666;font-family:monospace}#${ka_outputId} .${ka_prefix}-landmark-item .${ka_prefix}-issue{display:block;margin-top:4px;font-size:.9em}#${ka_outputId} .${ka_prefix}-landmark-item.${ka_prefix}-heading-error{background-color:#ffebee;border-left:3px solid #e57373;padding-left:5px;margin-left:-8px;padding-right:5px;margin-right:-5px;border-radius:3px}#${ka_outputId} .${ka_prefix}-landmark-item.${ka_prefix}-heading-error .${ka_prefix}-issue{color:#c62828}#${ka_outputId} .${ka_prefix}-landmark-warning{background-color:#fff3e0;border:1px solid #ffcc80;padding:10px;margin-bottom:15px;border-radius:3px;font-weight:bold;color:#e65100}.${ka_prefix}-highlight-focusable{outline:3px dashed #03A9F4!important;outline-offset:2px;box-shadow:0 0 5px 2px rgba(3,169,244,.5)!important;background-color:rgba(3,169,244,.05)!important;scroll-margin-top:50px!important;position:relative}.${ka_prefix}-highlight-focusable[data-kolla-tabindex]::before{content:"T=" var(--${ka_prefix}-tabindex-value,'?');position:absolute;top:-1.5em;left:-5px;background-color:#03A9F4;color:#fff;font-size:10px;font-weight:bold;padding:2px 4px;border-radius:2px;z-index:1;line-height:1;font-family:sans-serif;white-space:nowrap;text-align:center;min-width:2em;display:inline-block}.${ka_prefix}-highlight-focusable[data-kolla-tabindex-positive]::before{background-color:#f44336!important;color:#fff!important}#${ka_outputId} .${ka_prefix}-focusable-item{margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid #ddd;font-size:.95em}#${ka_outputId} .${ka_prefix}-focusable-order{display:inline-block;font-weight:bold;min-width:20px;text-align:right;margin-right:8px;color:#555}#${ka_outputId} .${ka_prefix}-focusable-element{font-family:monospace;display:inline;cursor:pointer;color:#005a9c}#${ka_outputId} .${ka_prefix}-focusable-element:hover{text-decoration:underline}#${ka_outputId} .${ka_prefix}-focusable-name{display:block;margin-left:28px;font-size:.9em;color:#333;word-wrap:break-word}#${ka_outputId} .${ka_prefix}-focusable-tabindex{display:block;margin-left:28px;font-size:.85em;color:#666}#${ka_outputId} .${ka_prefix}-focusable-item .${ka_prefix}-issue{display:block;margin-left:28px;margin-top:3px;font-size:.9em}#${ka_outputId} .${ka_prefix}-focusable-item.${ka_prefix}-heading-error{background-color:#ffebee;border-left:3px solid #e57373;padding:4px 5px 4px 5px;margin-left:-8px;padding-right:5px;margin-right:-5px;border-radius:3px}#${ka_outputId} .${ka_prefix}-focusable-item.${ka_prefix}-heading-error .${ka_prefix}-issue{color:#c62828}.${ka_prefix}-contrast-section{margin-bottom:15px;padding-bottom:15px;border-bottom:1px solid #eee}.${ka_prefix}-contrast-section:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}.${ka_prefix}-contrast-hr{border:none;border-top:2px solid #ddd;margin:20px 0}.${ka_prefix}-contrast-inputs{display:flex;gap:20px;margin-bottom:15px;flex-wrap:wrap}.${ka_prefix}-contrast-group label{display:block;font-weight:bold;margin-bottom:3px;font-size:.9em}.${ka_prefix}-contrast-input-row{display:flex;align-items:center;gap:5px}.${ka_prefix}-contrast-input-row input[type=text]{width:80px;padding:4px 6px;border:1px solid #ccc;border-radius:3px;font-size:.9em}.${ka_prefix}-contrast-input-row input[type=color]{width:30px;height:30px;border:1px solid #ccc;padding:0;cursor:pointer;background-color:#fff;border-radius:3px}.${ka_prefix}-contrast-results h4{border-bottom:none;margin-bottom:8px}.${ka_prefix}-contrast-results h5{font-size:0.95em;margin-top:12px;margin-bottom:5px;padding-bottom:2px;border-bottom:1px dotted #ccc}.${ka_prefix}-contrast-ratio{font-size:1.1em;margin-bottom:10px;text-align:center;padding:8px;background-color:#f0f0f0;border-radius:3px}.${ka_prefix}-contrast-ratio strong{font-weight:bold}.${ka_prefix}-contrast-details{margin-top:10px;font-size:0.95em}.${ka_prefix}-contrast-result-line{margin-bottom:6px;padding:3px 0;border-bottom:1px dotted #eee}.${ka_prefix}-contrast-result-line span{float:right;font-weight:bold;padding:0 5px;border-radius:3px}.${ka_prefix}-contrast-result-line span:first-child{margin-left:10px}}.${ka_prefix}-contrast-scan-btn{padding:6px 12px;background-color:#555;color:#fff;border:1px solid #777;border-radius:3px;cursor:pointer;transition:background-color .2s ease;margin-bottom:10px}.${ka_prefix}-contrast-scan-btn:hover{background-color:#666}.${ka_prefix}-contrast-scan-btn:disabled{background-color:#999;cursor:not-allowed}.${ka_prefix}-scan-results-area{border:1px solid #eee;padding:10px;max-height:250px;overflow-y:auto;font-size:0.9em}.${ka_prefix}-scan-results-area ul{list-style:none;padding:0;margin:0}.${ka_prefix}-contrast-issue-item{margin-bottom:8px;padding-bottom:8px;border-bottom:1px dotted #ccc}.${ka_prefix}-contrast-issue-item a{color:#005a9c;text-decoration:none;word-break:break-word}.${ka_prefix}-contrast-issue-item a:hover{text-decoration:underline}.${ka_prefix}-contrast-issue-tag{display:inline-block;font-family:monospace;margin-right:5px;color:#777}.${ka_prefix}-contrast-issue-details{font-size:0.9em;color:#444;margin-top:3px;margin-left:5px}.${ka_prefix}-highlight-contrast-issue{outline:3px dashed orange!important;box-shadow:0 0 5px 2px rgba(255,165,0,.5)!important;background-color:rgba(255,165,0,.05)!important}.${ka_prefix}-contrast-disclaimer{font-size:0.85em;color:#666;margin-top:10px;font-style:italic}`;const ka_styleElement=document.createElement("style");ka_styleElement.id=ka_styleId;ka_styleElement.textContent=ka_css;document.head.appendChild(ka_styleElement);const ka_toolbarElement=document.createElement("div");ka_toolbarElement.id=ka_toolbarId;ka_toolbarElement.setAttribute("role","toolbar");ka_toolbarElement.setAttribute("aria-label","Kolla A11y Accessibility Tools");ka_toolbarElement.innerHTML=`<button data-tool="headings" aria-pressed="false">Headings</button><button data-tool="images" aria-pressed="false">Images</button><button data-tool="links" aria-pressed="false">Links</button><button data-tool="landmarks" aria-pressed="false">Landmarks</button><button data-tool="focusable" aria-pressed="false">Focusable</button><button data-tool="contrast" aria-pressed="false">Contrast</button><button class="${ka_prefix}-close" aria-label="Close Kolla A11y Toolbar">×</button>`;document.body.appendChild(ka_toolbarElement);ka_toolbarElement.addEventListener("click",function(ka_event){const ka_target=ka_event.target;if(ka_target.tagName==="BUTTON"){if(ka_target.classList.contains(`${ka_prefix}-close`)){ka_cleanupAll()}else{const ka_tool=ka_target.getAttribute("data-tool");if(ka_tool){ka_activateTool(ka_tool,ka_target)}}}});const ka_firstButton=ka_toolbarElement.querySelector("button");if(ka_firstButton){ka_firstButton.focus()}console.log("Kolla A11y: Toolbar created.")}const ka_existingToolbarCheck=document.getElementById(ka_toolbarId);if(ka_existingToolbarCheck){console.log("Kolla A11y: Toolbar exists. Cleaning up.");ka_cleanupAll()}else{console.log("Kolla A11y: Toolbar not found. Creating.");ka_createToolbar()}})();
